<?xml version="1.0"?>
<block>
  <name>Convolutional Decoder (CCSDS)</name>
  <key>ccsds_conv_decode27</key>
  <category>CCSDS/Channelcoding</category>
  <import>import ccsds</import>
  <make>ccsds.conv_decode27($gen_poly_c1, $gen_poly_c2, int($punct.fcn), $num_bits_out, $ASM)</make>
	<param>
		<name>Generator Polynom C1</name>
		<key>gen_poly_c1</key>
		<value>0x79</value>
		<type>int</type>
	</param>
	<param>
		<name>Generator Polynom C2</name>
		<key>gen_poly_c2</key>
		<value>0xDB</value>
		<type>int</type>
	</param>
	<param>
		<name>Puncturing</name>
		<key>punct</key>
		<value>0</value>
		<type>enum</type>
		<option>
			<name>None</name>
			<key>NONE</key>
			<opt>fcn:0</opt>
		</option>
		<option>
			<name>ECSS 2/3</name>
			<key>ECSS_23</key>
			<opt>fcn:1</opt>
		</option>
		<option>
			<name>ECSS 3/4</name>
			<key>ECSS_34</key>
			<opt>fcn:2</opt>
		</option>
		<option>
			<name>ECSS 5/6</name>
			<key>ECSS_56</key>
			<opt>fcn:3</opt>
		</option>
		<option>
			<name>ECSS 7/8</name>
			<key>ECSS_78</key>
			<opt>fcn:4</opt>
		</option>
	</param>
	<param>
		<name>Output bits</name>
		<key>num_bits_out</key>
		<value>2040</value>
		<type>int</type>
	</param>
	<param>
		<name>Sync Marker (hex)</name>
		<key>ASM</key>
		<value>'1ACFFC1D'</value>
		<type>string</type>
	</param>
	<check>$gen_poly_c1 >= 0</check>
	<check>$gen_poly_c2 >= 0</check>
	<check>$gen_poly_c1 &lt;= 255</check>
	<check>$gen_poly_c2 &lt;= 255</check>
	<check>$num_bits_out > 0</check>
	<check>$num_bits_out % 8 == 0</check>
	<check>len($ASM) % 2 == 0</check>
	<sink>
		<name>in</name>
		<type>message</type>
	</sink>
	<source>
		<name>out</name>
		<type>message</type>
	</source>
	<doc>
Convolutional Decoder with unpuncturing

Performs unpuncturing of incomming softbits by adding erasure softbits at the 
punctured positions and convolutional decodes the unpunctured softbits. Outputs
a BLOB with the packed decoded bytes.

The compact generator polynom contains two informations. Encoded in the MSB is
the information whether the stream should be inverted (MSB set) or not (MSB
unset). Encoded in the 7 less significant bits is the information about the
connections between the shift registers and the output. The MSB-1 represents the
influence of the current information bit i(t) while the LSB represents the
influence of the information bit i(t-6). A set bit means there is a connection,
while an unset bit means there is no.

The polynomials for the convolutional code defined in ECSS can be generated with
0x79 for c1 and 0x5B for c2. Together with the MSB for the inversion of c2 the
compact polynomials are 0x79 and 0xDB for non puncturing. For puncturing, the
inversion is not performed, so the compact generator polynomials are 0x79 for c1
and 0x5B for c2.

This block will output num_bits_out decoded bits as packed bytes in a BLOB
message. The input consists of a f32vector of floats containing softbits, where
-1.0f corresponds to the strongest zero bit, 0.0f corresponds to an erasure and
1.0f corresponds to the strongest one bit. The number of input softbits must be
chosen in a way that after unpuncturing there are exactly num_bits_out*2+12
input elements.

The ASM is used to determine the start and termination state of the viterbi
decoder. If data that goes into this block has been generated by starting with
zeros as input and additional zeroes are added as tail, provide a 2 byte zeros
ASM to make this block use the zero start and stop state.
	</doc>
</block>
